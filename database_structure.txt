# Swadiq Schools Database Structure

## Tables and Columns

### 1. users
- id (UUID, PRIMARY KEY)
- email (VARCHAR(255), UNIQUE, NOT NULL)
- password (VARCHAR(255), NOT NULL)
- first_name (VARCHAR(100), NOT NULL)
- last_name (VARCHAR(100), NOT NULL)
- is_active (BOOLEAN, DEFAULT true)
- created_at (TIMESTAMP WITH TIME ZONE, DEFAULT NOW())
- updated_at (TIMESTAMP WITH TIME ZONE, DEFAULT NOW())
- deleted_at (TIMESTAMP WITH TIME ZONE)

### 2. roles
- id (UUID, PRIMARY KEY)
- name (VARCHAR(100), UNIQUE, NOT NULL)
- is_active (BOOLEAN, DEFAULT true)
- created_at (TIMESTAMP WITH TIME ZONE, DEFAULT NOW())
- updated_at (TIMESTAMP WITH TIME ZONE, DEFAULT NOW())
- deleted_at (TIMESTAMP WITH TIME ZONE)

### 3. user_roles
- id (UUID, PRIMARY KEY)
- user_id (UUID, NOT NULL, REFERENCES users(id) ON DELETE CASCADE)
- role_id (UUID, NOT NULL, REFERENCES roles(id) ON DELETE CASCADE)
- created_at (TIMESTAMP WITH TIME ZONE, DEFAULT NOW())
- deleted_at (TIMESTAMP WITH TIME ZONE)
- UNIQUE (user_id, role_id)

### 4. sessions
- id (VARCHAR(255), PRIMARY KEY)
- user_id (UUID, NOT NULL, REFERENCES users(id) ON DELETE CASCADE)
- expires_at (TIMESTAMP WITH TIME ZONE, NOT NULL)
- created_at (TIMESTAMP WITH TIME ZONE, DEFAULT NOW())

### 5. permissions
- id (UUID, PRIMARY KEY)
- name (VARCHAR(100), UNIQUE, NOT NULL)
- created_at (TIMESTAMP WITH TIME ZONE, DEFAULT NOW())
- deleted_at (TIMESTAMP WITH TIME ZONE)

### 6. role_permissions
- id (UUID, PRIMARY KEY)
- role_id (UUID, NOT NULL, REFERENCES roles(id) ON DELETE CASCADE)
- permission_id (UUID, NOT NULL, REFERENCES permissions(id) ON DELETE CASCADE)
- created_at (TIMESTAMP WITH TIME ZONE, DEFAULT NOW())
- deleted_at (TIMESTAMP WITH TIME ZONE)
- UNIQUE (role_id, permission_id)

### 7. parents
- id (UUID, PRIMARY KEY)
- first_name (VARCHAR(100), NOT NULL)
- last_name (VARCHAR(100), NOT NULL)
- phone (VARCHAR(20))
- email (VARCHAR(255))
- address (TEXT)
- is_active (BOOLEAN, DEFAULT true)
- created_at (TIMESTAMP WITH TIME ZONE, DEFAULT NOW())
- updated_at (TIMESTAMP WITH TIME ZONE, DEFAULT NOW())
- deleted_at (TIMESTAMP WITH TIME ZONE)

### 8. classes
- id (UUID, PRIMARY KEY)
- name (VARCHAR(100), NOT NULL)
- teacher_id (UUID, REFERENCES users(id))
- is_active (BOOLEAN, DEFAULT true)
- created_at (TIMESTAMP WITH TIME ZONE, DEFAULT NOW())
- updated_at (TIMESTAMP WITH TIME ZONE, DEFAULT NOW())
- deleted_at (TIMESTAMP WITH TIME ZONE)

### 9. students
- id (UUID, PRIMARY KEY)
- student_id (VARCHAR(20), UNIQUE, NOT NULL)
- first_name (VARCHAR(100), NOT NULL)
- last_name (VARCHAR(100), NOT NULL)
- date_of_birth (DATE)
- gender (VARCHAR(10), CHECK (gender IN ('male', 'female', 'other')))
- address (TEXT)
- class_id (UUID, REFERENCES classes(id))
- is_active (BOOLEAN, DEFAULT true)
- created_at (TIMESTAMP WITH TIME ZONE, DEFAULT NOW())
- updated_at (TIMESTAMP WITH TIME ZONE, DEFAULT NOW())
- deleted_at (TIMESTAMP WITH TIME ZONE)

### 10. student_parents
- id (UUID, PRIMARY KEY)
- student_id (UUID, NOT NULL, REFERENCES students(id) ON DELETE CASCADE)
- parent_id (UUID, NOT NULL, REFERENCES parents(id) ON DELETE CASCADE)
- relationship (VARCHAR(20), NOT NULL)
- is_primary (BOOLEAN, DEFAULT false)
- created_at (TIMESTAMP WITH TIME ZONE, DEFAULT NOW())
- updated_at (TIMESTAMP WITH TIME ZONE, DEFAULT NOW())
- deleted_at (TIMESTAMP WITH TIME ZONE)
- UNIQUE (student_id, parent_id)

### 11. departments
- id (UUID, PRIMARY KEY)
- name (VARCHAR(100), NOT NULL)
- code (VARCHAR(20), UNIQUE, NOT NULL)
- description (TEXT)
- head_of_department_id (UUID, REFERENCES users(id))
- assistant_head_id (UUID, REFERENCES users(id))
- is_active (BOOLEAN, DEFAULT true)
- created_at (TIMESTAMP WITH TIME ZONE, DEFAULT NOW())
- updated_at (TIMESTAMP WITH TIME ZONE, DEFAULT NOW())
- deleted_at (TIMESTAMP WITH TIME ZONE)

### 12. subjects
- id (UUID, PRIMARY KEY)
- name (VARCHAR(100), NOT NULL)
- code (VARCHAR(20), UNIQUE, NOT NULL)
- department_id (UUID, REFERENCES departments(id))
- is_active (BOOLEAN, DEFAULT true)
- created_at (TIMESTAMP WITH TIME ZONE, DEFAULT NOW())
- updated_at (TIMESTAMP WITH TIME ZONE, DEFAULT NOW())
- deleted_at (TIMESTAMP WITH TIME ZONE)

### 13. class_subjects
- id (UUID, PRIMARY KEY)
- class_id (UUID, NOT NULL, REFERENCES classes(id) ON DELETE CASCADE)
- subject_id (UUID, NOT NULL, REFERENCES subjects(id) ON DELETE CASCADE)
- created_at (TIMESTAMP WITH TIME ZONE, DEFAULT NOW())
- deleted_at (TIMESTAMP WITH TIME ZONE)
- UNIQUE (class_id, subject_id)

### 14. academic_years
- id (UUID, PRIMARY KEY)
- name (VARCHAR(100), UNIQUE, NOT NULL)
- start_date (DATE, NOT NULL)
- end_date (DATE, NOT NULL)
- is_current (BOOLEAN, DEFAULT false)
- is_active (BOOLEAN, DEFAULT true)
- created_at (TIMESTAMP WITH TIME ZONE, DEFAULT NOW())
- updated_at (TIMESTAMP WITH TIME ZONE, DEFAULT NOW())
- deleted_at (TIMESTAMP WITH TIME ZONE)

### 15. terms
- id (UUID, PRIMARY KEY)
- academic_year_id (UUID, NOT NULL, REFERENCES academic_years(id) ON DELETE CASCADE)
- name (VARCHAR(100), NOT NULL)
- start_date (DATE, NOT NULL)
- end_date (DATE, NOT NULL)
- is_current (BOOLEAN, DEFAULT false)
- is_active (BOOLEAN, DEFAULT true)
- created_at (TIMESTAMP WITH TIME ZONE, DEFAULT NOW())
- updated_at (TIMESTAMP WITH TIME ZONE, DEFAULT NOW())
- deleted_at (TIMESTAMP WITH TIME ZONE)

### 16. class_promotions
- id (UUID, PRIMARY KEY)
- from_class_id (UUID, NOT NULL, REFERENCES classes(id) ON DELETE CASCADE)
- to_class_id (UUID, NOT NULL, REFERENCES classes(id) ON DELETE CASCADE)
- academic_year_id (UUID, REFERENCES academic_years(id))
- promotion_criteria (TEXT)
- is_active (BOOLEAN, DEFAULT true)
- created_at (TIMESTAMP WITH TIME ZONE, DEFAULT NOW())
- updated_at (TIMESTAMP WITH TIME ZONE, DEFAULT NOW())
- deleted_at (TIMESTAMP WITH TIME ZONE)
- UNIQUE (from_class_id, academic_year_id)

### 17. attendance
- id (UUID, PRIMARY KEY)
- student_id (UUID, NOT NULL, REFERENCES students(id) ON DELETE CASCADE)
- class_id (UUID, NOT NULL, REFERENCES classes(id) ON DELETE CASCADE)
- date (DATE, NOT NULL)
- status (VARCHAR(10), NOT NULL, CHECK (status IN ('present', 'absent', 'late')))
- created_at (TIMESTAMP WITH TIME ZONE, DEFAULT NOW())
- updated_at (TIMESTAMP WITH TIME ZONE, DEFAULT NOW())
- deleted_at (TIMESTAMP WITH TIME ZONE)

### 18. fee_types
- id (UUID, PRIMARY KEY)
- name (VARCHAR(100), UNIQUE, NOT NULL)
- code (VARCHAR(20), UNIQUE, NOT NULL)
- description (TEXT)
- is_active (BOOLEAN, DEFAULT true)
- created_at (TIMESTAMP WITH TIME ZONE, DEFAULT NOW())
- updated_at (TIMESTAMP WITH TIME ZONE, DEFAULT NOW())
- deleted_at (TIMESTAMP WITH TIME ZONE)

### 19. fees
- id (UUID, PRIMARY KEY)
- student_id (UUID, NOT NULL, REFERENCES students(id) ON DELETE CASCADE)
- fee_type_id (UUID, NOT NULL, REFERENCES fee_types(id) ON DELETE CASCADE)
- academic_year_id (UUID, REFERENCES academic_years(id))
- term_id (UUID, REFERENCES terms(id))
- title (VARCHAR(100), NOT NULL)
- amount (NUMERIC(10, 2), NOT NULL)
- balance (NUMERIC(10, 2), DEFAULT 0)
- currency (VARCHAR(3), NOT NULL, DEFAULT 'USD')
- paid (BOOLEAN, DEFAULT false)
- due_date (DATE, NOT NULL)
- paid_at (TIMESTAMP WITH TIME ZONE)
- created_at (TIMESTAMP WITH TIME ZONE, DEFAULT NOW())
- updated_at (TIMESTAMP WITH TIME ZONE, DEFAULT NOW())
- deleted_at (TIMESTAMP WITH TIME ZONE)

### 20. payments
- id (UUID, PRIMARY KEY)
- student_id (UUID, NOT NULL, REFERENCES students(id) ON DELETE CASCADE)
- total_amount (NUMERIC(10, 2), NOT NULL)
- payment_date (DATE, NOT NULL)
- payment_method (VARCHAR(50))
- paid_by (UUID, NOT NULL, REFERENCES users(id))
- transaction_id (VARCHAR(255))
- status (VARCHAR(20), DEFAULT 'pending')
- paid_at (TIMESTAMP WITH TIME ZONE, DEFAULT NOW())
- created_at (TIMESTAMP WITH TIME ZONE, DEFAULT NOW())
- updated_at (TIMESTAMP WITH TIME ZONE, DEFAULT NOW())
- deleted_at (TIMESTAMP WITH TIME ZONE)

### 21. payment_allocations
- id (UUID, PRIMARY KEY)
- payment_id (UUID, NOT NULL, REFERENCES payments(id) ON DELETE CASCADE)
- fee_type_id (UUID, NOT NULL, REFERENCES fee_types(id) ON DELETE CASCADE)
- amount (NUMERIC(10, 2), NOT NULL)
- balance (NUMERIC(10, 2), DEFAULT 0)
- is_fully_paid (BOOLEAN, DEFAULT false)
- created_at (TIMESTAMP WITH TIME ZONE, DEFAULT NOW())
- updated_at (TIMESTAMP WITH TIME ZONE, DEFAULT NOW())
- deleted_at (TIMESTAMP WITH TIME ZONE)

### 22. papers
- id (UUID, PRIMARY KEY)
- subject_id (UUID, NOT NULL, REFERENCES subjects(id) ON DELETE CASCADE)
- teacher_id (UUID, REFERENCES users(id))
- name (VARCHAR(100), NOT NULL)
- code (VARCHAR(20), UNIQUE, NOT NULL)
- is_active (BOOLEAN, DEFAULT true)
- created_at (TIMESTAMP WITH TIME ZONE, DEFAULT NOW())
- updated_at (TIMESTAMP WITH TIME ZONE, DEFAULT NOW())
- deleted_at (TIMESTAMP WITH TIME ZONE)

### 23. grades
- id (UUID, PRIMARY KEY)
- name (VARCHAR(10), NOT NULL)
- min_marks (NUMERIC(5, 2), NOT NULL)
- max_marks (NUMERIC(5, 2), NOT NULL)
- is_active (BOOLEAN, DEFAULT true)
- created_at (TIMESTAMP WITH TIME ZONE, DEFAULT NOW())
- updated_at (TIMESTAMP WITH TIME ZONE, DEFAULT NOW())
- deleted_at (TIMESTAMP WITH TIME ZONE)

### 24. exams
- id (UUID, PRIMARY KEY)
- name (VARCHAR(100), NOT NULL)
- class_id (UUID, NOT NULL, REFERENCES classes(id) ON DELETE CASCADE)
- academic_year_id (UUID, REFERENCES academic_years(id))
- term_id (UUID, REFERENCES terms(id))
- paper_id (UUID, NOT NULL, REFERENCES papers(id) ON DELETE CASCADE)
- start_time (TIMESTAMP WITH TIME ZONE, NOT NULL)
- end_time (TIMESTAMP WITH TIME ZONE, NOT NULL)
- is_active (BOOLEAN, DEFAULT true)
- created_at (TIMESTAMP WITH TIME ZONE, DEFAULT NOW())
- updated_at (TIMESTAMP WITH TIME ZONE, DEFAULT NOW())
- deleted_at (TIMESTAMP WITH TIME ZONE)

### 25. results
- id (UUID, PRIMARY KEY)
- exam_id (UUID, NOT NULL, REFERENCES exams(id) ON DELETE CASCADE)
- student_id (UUID, NOT NULL, REFERENCES students(id) ON DELETE CASCADE)
- paper_id (UUID, NOT NULL, REFERENCES papers(id) ON DELETE CASCADE)
- marks (NUMERIC(5, 2), NOT NULL)
- grade_id (UUID, REFERENCES grades(id))
- created_at (TIMESTAMP WITH TIME ZONE, DEFAULT NOW())
- updated_at (TIMESTAMP WITH TIME ZONE, DEFAULT NOW())
- deleted_at (TIMESTAMP WITH TIME ZONE)

### 26. schedules
- id (UUID, PRIMARY KEY)
- class_id (UUID, NOT NULL, REFERENCES classes(id) ON DELETE CASCADE)
- subject_id (UUID, NOT NULL, REFERENCES subjects(id) ON DELETE CASCADE)
- teacher_id (UUID, NOT NULL, REFERENCES users(id))
- day (VARCHAR(10), NOT NULL)
- start_time (TIME, NOT NULL)
- end_time (TIME, NOT NULL)
- created_at (TIMESTAMP WITH TIME ZONE, DEFAULT NOW())
- updated_at (TIMESTAMP WITH TIME ZONE, DEFAULT NOW())
- deleted_at (TIMESTAMP WITH TIME ZONE)

### 27. categories
- id (UUID, PRIMARY KEY)
- name (VARCHAR(100), NOT NULL)
- is_active (BOOLEAN, DEFAULT true)
- created_at (TIMESTAMP WITH TIME ZONE, DEFAULT NOW())
- updated_at (TIMESTAMP WITH TIME ZONE, DEFAULT NOW())
- deleted_at (TIMESTAMP WITH TIME ZONE)

### 28. expenses
- id (UUID, PRIMARY KEY)
- category_id (UUID, NOT NULL, REFERENCES categories(id) ON DELETE CASCADE)
- title (VARCHAR(100), NOT NULL)
- amount (NUMERIC(10, 2), NOT NULL)
- date (DATE, NOT NULL)
- created_at (TIMESTAMP WITH TIME ZONE, DEFAULT NOW())
- updated_at (TIMESTAMP WITH TIME ZONE, DEFAULT NOW())
- deleted_at (TIMESTAMP WITH TIME ZONE)

### 29. notifications
- id (UUID, PRIMARY KEY)
- subject (VARCHAR(255), NOT NULL)
- body (TEXT, NOT NULL)
- recipient_id (UUID, NOT NULL)
- recipient_type (VARCHAR(20), NOT NULL)
- email (VARCHAR(255), NOT NULL)
- is_sent (BOOLEAN, DEFAULT false)
- sent_at (TIMESTAMP WITH TIME ZONE)
- template (VARCHAR(100))
- retry_count (INTEGER, DEFAULT 0)
- attachment_urls (TEXT[])
- created_at (TIMESTAMP WITH TIME ZONE, DEFAULT NOW())
- updated_at (TIMESTAMP WITH TIME ZONE, DEFAULT NOW())
- deleted_at (TIMESTAMP WITH TIME ZONE)